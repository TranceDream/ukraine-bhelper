# 部署文档

## 1.部署环境

本项目部署环境：

- 硬件环境

​		华为云服务器

​		鲲鹏内存优化型|km1.large.8|2vCPUs|16GiB

​		网络：300M，按需付费

- 操作系统

  CentOS 7.6 64bit with ARM|公共镜像

- 其他：

  开放端口：80，81，8006(图片代理)

  如需再次开发，建议开放40065，方便查看log

  

**注意**：不建议使用华为云鲲鹏处理器，因为可能会有一些未知的bug，并且安装过程较为繁琐。由于社区，或者技术文档缺乏，一些bug难以修复。

## 2. 所需软件

### 2.1  检查安装JDK

1.查看云端目前支持安装的JDK版本

```vim
yum search java|grep jdk
```

 2.选择JDK版本，并安装

```apache
yum install -y java-1.7.0-openjdk
```

3.检查是否安装成功

```applescript
java -version
```

 4.查看JDK的安装目录

```routeros
find / -name 'java'
```

### 2.2 安装MYSQL8

####  Mysql8.0安装 (YUM方式)

1. 首先删除系统默认或之前可能安装的其他版本的mysql

```reasonml
[root@DB-node01 ~]# for i in $(rpm -qa|grep mysql);do rpm -e $i --nodeps;done
[root@DB-node01 ~]# rm -rf /var/lib/mysql && rm -rf /etc/my.cnf
```

2. 安装Mysql8.0 的yum资源库

```arduino
mysql80-community-release-el7-1.noarch.rpm    
 
[root@DB-node01 ~]# yum localinstall https://repo.mysql.com//mysql80-community-release-el7-1.noarch.rpm
```

3. 安装Mysql8.0

```autoit
[root@DB-node01 ~]# yum install mysql-community-server
   
#启动MySQL服务器和MySQL的自动启动
[root@DB-node01 ~]# systemctl start mysqld
[root@DB-node01 ~]# systemctl enable mysqld
```

4. 使用默认密码初次登录后, **必须要重置密码**

```subunit
查看默认密码, 如下默认密码为"e53xDalx.*dE"
[root@DB-node01 ~]# grep 'temporary password' /var/log/mysqld.log
2019-03-06T01:53:19.897262Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: e53xDalx.*dE
  
[root@DB-node01 ~]# mysql -pe53xDalx.*dE
............
mysql> select version();
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
```

**报错提示必须要重置初始密码**, 下面开始重置mysql登录密码（注意要切换到mysql数据库，使用use

```subunit
mysql> use mysql;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
   
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
```

**这个其实与validate_password_policy的值有关, mysql8.0更改了validate_password_policy相关的配置名称**, 这跟Mysql5.7有点不一样了.

```apache
mysql> set global validate_password.policy=0;
Query OK, 0 rows affected (0.00 sec)
   
mysql> set global validate_password.length=1;
Query OK, 0 rows affected (0.00 sec)
```

接着再修改密码

```sas
[mysql](http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247495595&idx=1&sn=f6c169e610b38050c4eecda80f23cf37&chksm=e9188ab7de6f03a1531aa276b91cdbbc43d4ef0fafa13f21f8b6d93c88710e350f0b10ff18b1&scene=21#wechat_redirect)> ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
Query OK, 0 rows affected (0.05 sec)
   
mysql> flush privileges;
Query OK, 0 rows affected (0.03 sec)
```

退出, 重新使用新密码登录mysql

```jboss-cli
[root@DB-node01 ~]# mysql -p123456
...........
mysql> select version();
+-----------+
| version() |
+-----------+
| 8.0.15    |
+-----------+
1 row in set (0.00 sec)
```

查看服务端口

```asciidoc
mysql> show global variables like 'port';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| port          | 3306  |
+---------------+-------+
1 row in set (0.01 sec)
```

查看mysql连接的授权信息

```subunit
mysql> select host,user,password from mysql.user;
ERROR 1054 (42S22): Unknown column 'password' in 'field list'
```

上面这是mysql5.6及以下版本的查看命令, mysql5.7之后的数据库里mysql.user表里已经没有password这个字段了，password字段改成了authentication_string。

```asciidoc
mysql> select host,user,authentication_string from mysql.user;
+-----------+------------------+------------------------------------------------------------------------+
| host      | user             | authentication_string                                                  |
+-----------+------------------+------------------------------------------------------------------------+
| localhost | mysql.infoschema | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.session    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.sys        | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | root             | $A$005${7J0=4Dc7Jym8eI/FU4jimKWFvkD9XmoAkF1ca5.Un0bc6zgmPtU.0          |
+-----------+------------------+------------------------------------------------------------------------+
4 rows in set (0.00 sec)
```

mysql8.0修改用户密码命令

```pgsql
mysql> use mysql;
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
mysql> flush privileges;Mysql8.0使用过程中踩过的一些坑
```

#### 可能遇到的一些问题

- 1)创建用户和授权 在mysql8.0创建用户和授权和之前不太一样了，其实严格上来讲，也不能说是不一样, 只能说是更严格, mysql8.0需要先创建用户(创建用户时要带@并指定地址, 则grant授权时的地址就是这个@后面指定的!, 否则grant授权就会报错!)和设置密码,然后才能授权。

```routeros
mysql> create user 'kevin'@'%' identified by '123456';
Query OK, 0 rows affected (0.04 sec)
 
mysql> grant all privileges on *.* to 'kevin'@'%' with grant option;   
Query OK, 0 rows affected (0.04 sec)
 
mysql> create user 'bobo'@'%' identified by '123456';    
Query OK, 0 rows affected (0.06 sec)
 
mysql> grant all privileges on *.* to 'bobo'@'%' with grant option;
Query OK, 0 rows affected (0.03 sec)
 
mysql> flush privileges;
Query OK, 0 rows affected (0.04 sec)
 
mysql> select host,user,authentication_string from mysql.user;
+-----------+------------------+------------------------------------------------------------------------+
| host      | user             | authentication_string                                                  |
+-----------+------------------+------------------------------------------------------------------------+
| %         | bobo             | $A$005$1VY")q?G6<^X@-6LsXrPt5C0TwlTuvHbaOa3sYF0DKViIGoRPuCF8AzwiFcim1  |
| %         | kevin            | $A$005$hy`U}ZB#R::rA8W0y2rmwgySqzv0rmR1eTeNDSaXfQPWIsrh7ytbVdi85       |
| localhost | mysql.infoschema | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.session    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.sys        | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | root             | $A$005$/VO_y^7,]6;2qxggBLmJzhA0Qylu5/AHuRScZ/ykKedgZKh/6krOIzPs2       |
+-----------+------------------+------------------------------------------------------------------------+
```

**如果还是用Mysql5.7及之前版本的直接授权的方法, 会有报错**

- 2)**Mysql8.0默认是不能使用root账号进行远程登录的! root账号只能本地登录!**

```gherkin
mysql> select host,user,authentication_string from mysql.user;
+-----------+------------------+------------------------------------------------------------------------+
| host      | user             | authentication_string                                                  |
+-----------+------------------+------------------------------------------------------------------------+
| %         | bobo             | $A$005$1VY")q?G6<^X@-6LsXrPt5C0TwlTuvHbaOa3sYF0DKViIGoRPuCF8AzwiFcim1 |
| %         | kevin            | $A$005$hy`U}ZB#R::rA8W0y2rmwgySqzv0rmR1eTeNDSaXfQPWIsrh7ytbVdi85 |
| localhost | mysql.infoschema | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.session    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.sys        | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | root             | $A$005$/VO_y^7,]6;2qxggBLmJzhA0Qylu5/AHuRScZ/ykKedgZKh/6krOIzPs2 |
+-----------+------------------+------------------------------------------------------------------------+
6 rows in set (0.00 sec)
```

如果想要远程登录, 则需要进行update更新下root账号的权限

```asciidoc
mysql> update mysql.user set host='%' where user="root";
Query OK, 1 row affected (0.10 sec)
Rows matched: 1  Changed: 1  Warnings: 0
 
mysql> flush privileges;
Query OK, 0 rows affected (0.14 sec)
 
mysql> select host,user,authentication_string from mysql.user;
+-----------+------------------+------------------------------------------------------------------------+
| host      | user             | authentication_string                                                  |
+-----------+------------------+------------------------------------------------------------------------+
| %         | bobo             | $A$005$1VY")q?G6<^X@-6LsXrPt5C0TwlTuvHbaOa3sYF0DKViIGoRPuCF8AzwiFcim1  |
| %         | kevin            | $A$005$hy`U}ZB#R::rA8W0y2rmwgySqzv0rmR1eTeNDSaXfQPWIsrh7ytbVdi85       |
| %         | root             | $A$005$/VO_y^7,]6;2qxggBLmJzhA0Qylu5/AHuRScZ/ykKedgZKh/6krOIzPs2       |
| localhost | mysql.infoschema | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.session    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| localhost | mysql.sys        | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
+-----------+------------------+------------------------------------------------------------------------+
6 rows in set (0.00 sec)
```

这样就能在远程使用root账号登录该mysql8.0的数据库了

修改root账号权限, 允许root账号远程登录后, 用navicat进行mysql的远程连接时，出现了弹窗报错。出现这个原因是mysql8 之前的版本中加密规则是mysql_native_password, 而在mysql8之后,加密规则是caching_sha2_password, 解决问题方法:

一种是把mysql用户登录密码加密规则还原成mysql_native_password; 

```pgsql
#修改加密规则
mysql> ALTER USER 'root'@'%' IDENTIFIED BY '123456' PASSWORD EXPIRE NEVER;       
Query OK, 0 rows affected (0.16 sec)
 
#更新一下用户的密码
mysql> ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
Query OK, 0 rows affected (0.08 sec)
 
#刷新权限
mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.03 sec)
```

这样问题就解决了。 

#### 项目需要的数据库表

见附录

### 2.3 安装nginx

1、安装nginx编译环境

```
yum -y install gcc-c++

yum -y install pcre-devel openssl openssl-devel
```

2、安装之前检查是否有安装过nginx

```find -name nginx```

3、如果有安装卸载

```yum remove nginx```

4、选择你想要安装的目录，我选择的是/usr/local下的目录安装

```cd /usr/local```

5、然后下载最新的nginx

```wget http://nginx.org/download/nginx-1.12.0.tar.gz```

6、解压nginx包

``tar -zxvf nginx-1.12.0.tar.gz``

7、配置nginx安装信息

 解压之后进入nginx安装目录后，执行以下语句：

```./configure --prefix=/home/gaochao/nginx --with-http_ssl_module```

注：–prefix 参数：指定安装目录；–with-http_ssl_module：编译的时候启用SSL支持

8、然后编译、安装

```
make
make install
```

9、使用命令查看nginx的安装路径

```whereis nginx```

10、给nginx目录权限

```chmod -R 777 /usr/local/nginx/```

进入cd /usr/local/nginx/sbin/启动nginx./nginx，然后查看nginx服务是否成功netstat -ntlp

然后根据ip进行访问即可.

**11.nginx配置限流**

配置文件见附录



### 2.4 安装redis

1. 安装gcc依赖
   由于 redis 是用 C 语言开发，安装之前必先确认是否安装 gcc 环境（gcc -v），如果没有安装，执行以下命令进行安装（因为这一步没有做导致我执行安装命令一直报错）

```
yum install -y gcc 
```

2. 下载Redis  
   官网下载地址：https://redis.io/download
   找到要下载的版本右键复制下载链接
3. 都知道虚拟机可以使用wget命令直接联网下载 但是这个下载路径也很重要 所以这一步👆一定要自己进入官网复制 网上很多教程都是直接给的一个下载命令 但是那个命令里面的版本不一定都还在 所以必须要自己去复制一下这个下载路径
   然后输入wget + 刚刚复制的下载路径 回车进行下载

```wget https://download.redis.io/releases/redis-6.2.5.tar.gz``



4. 解压redis
   下载完后使用解压命令进行解压

    ```tar -zvxf redis-6.2.5.tar.gz```

    解压完成后使用ls命令可以看到当前文件夹有两个文件


    因为 redis一般放在/usr/local/redis路径下 所以要使用命令将文件移动过去 这里我的文件在opt下
    
    ```mv /opt/redis-6.2.5 /usr/local/redis```
    
    cd 到/usr/local目录下可以查看到当前目录已经多了一个redis子目录

5. 安装redis
   进入到redis目录输入make执行编译命令

   再输入如下命令进行安装

   ``` make PREFIX=/usr/local/redis install```


    启动redis
    
    cd bin
    ./redis-server
    
    从 redis 的源码目录中复制 redis.conf 到 redis 的安装目录

```cp /opt/redis-6.2.5/redis.conf /usr/local/redis/bin/```

6. 修改 redis.conf 文件，把 daemonize no 改为 daemonize yes 

``` vi redis.conf```

```./redis-server redis.conf```

7. 查看Redis是否正在运行
   ```ps -ef | grep redis```

​	```redis-cli```

​	./redis-cli是连接本地redis服务的一个命令，通过该命令后可以既可控制redis的脚本控制台



​	如果 Redis报错：-bash: redis-cli: command not found 

​	将redis-cli拷贝到bin下，让redis-cli指令可以在任意目录下直接使用

```	cp /opt/redis-6.2.5/src/redis-cli.c /usr/local/redis/bin```

**服务操作命令**

```
systemctl start redis.service   #启动redis服务

systemctl stop redis.service   #停止redis服务

systemctl restart redis.service   #重新启动服务

systemctl status redis.service   #查看服务当前状态

systemctl enable redis.service   #设置开机自启动

systemctl disable redis.service   #停止开机自启动
```





### 2.5 安装rabbitMQ

因为RabbitMQ是由Erlang语言开发的所以需要安装Erlang的开发环境，再安装RabbitMQ

**安装Erlang**

```
curl -s https://packagecloud.io/install/repositories/rabbitmq/erlang/script.rpm.sh | sudo bash
```



```
yum install erlang -y
```



 `安装完erlang后检验版本`

```
erl -version
```



安装rabbitmq

```
yum install rabbitmq-server -y
```



**配置rabbitmq**

```
# 开机启动
systemctl enable rabbitmq-server.service# 启动rabbitmqsystemctl start rabbitmq-server.service

# 开启后台管理
rabbitmq-plugins enable rabbitmq_management

# 设置后台管理员
rabbitmqctl add_user fahaxiki 'fhxj123'
rabbitmqctl set_user_tags fahaxiki administrator
rabbitmqctl set_permissions -p / fahaxiki '.*' '.*' '.*'

# 重启rabbitmq
systemctl restart rabbitmq-server.service
```

启动rabbitmq后，可以通过[http://x.x.x.x:15672](https://link.zhihu.com/?target=http%3A//x.x.x.x%3A15672)访问管理后台，使用上面设置的管理员账号登录。

注意端口[15672](https://link.zhihu.com/?target=http%3A//x.x.x.x%3A15672)是否开放

![img](https://img2022.cnblogs.com/blog/1958533/202202/1958533-20220210151441001-348092435.png)

登录成功

<img src="https://img2022.cnblogs.com/blog/1958533/202202/1958533-20220210151253714-749230680.png" alt="img" style="zoom:67%;" />

![img](https://img2022.cnblogs.com/blog/1958533/202202/1958533-20220210143028668-2084416275.jpg)

 

 

 



### 2.6 安装nacos

下载

1. 官网下载

2.  解压

```
cd /home/busapp/service/
tar xvf nacos.tar.gz
```

3. 数据库配置

见附录三

4. 修改配置

```
cd /home/busapp/service/nacos/conf/
vim application.properties

db.num=1
db.url.0=jdbc:mysql://localhost:3306/nacos-mysql??characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true
db.user=root
db.password=123456
```

4. 启用

```
cd /home/busapp/service/nacos/bin/
./startup.sh -m standalone &
```

## 3 部署

### 3.1 前端部署

需要安装node环境
对于使用Node的环境，处理这个最简单的方法是安装serve并让它处理其余的：

```
npm install -g serve
serve -s build
```


上面显示的最后一个命令将在端口3000上为您的静态站点提供服务。像许多serve的内部设置一样，可以使用-l或--listen标志调整端口：

```
serve -s build -l 4000
```


运行此命令以获取可用选项的完整列表：

```
serve -h
```


另外你可以直接使用这条

```
serve -s
```

然后你需要cd dist文件下
运行

```
serve -s
```

使用screen进行会话管理

需要安装screen

```


 tar -xzvf build.tar.gz 

 screen

 screen -ls

kill ID

serve -S ./
```

### 3.2 后端部署

首先在本地进行maven编译

生成jar包

| 服务名        | 部署命令F                                                    | FIRST | SECOND |
| ------------- | ------------------------------------------------------------ | ----- | ------ |
| Gateway       | nohup java -jar Gateway-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/Gateway.log & | 9001  | 9011   |
| UserService   | nohup java -jar UserService-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/UserService.log & | 8001  |        |
| HouseService  | nohup java -jar HouseService-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/HouseService.log & | 8002  | 8012   |
| SystemService | nohup java -jar SystemService-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/System.log & | 8003  |        |
| AuditService  | nohup java -jar AuditService-0.0.1-SNAPSHOT.jar >/Ukother/Uklog/Audit.log & | 8004  |        |
| ReportService | nohup java -jar ReportService-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/report.log & | 8005  |        |
| NewsService   | nohup java -jar NewsService-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/NewService.log & | 8006  |        |
| PicService    | nohup java -jar PicService-0.0.1-SNAPSHOT.jar > /Ukother/Uklog/Pic.log  & | 8007  |        |

服务器实际

![image-20220521234203145](C:\Users\15900\AppData\Roaming\Typora\typora-user-images\image-20220521234203145.png)

log目录

![image-20220521234226552](C:\Users\15900\AppData\Roaming\Typora\typora-user-images\image-20220521234226552.png)

## 附录1-项目数据库表

### 数据库-UA

```mysql
#共21张表
CREATE TABLE `AUDIT` (
  `AUDIT_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `OBJTYPE_ID` int NOT NULL,
  `OPERATOR` mediumtext NOT NULL,
  `OPER` int NOT NULL,
  `MESSAGE` varchar(200) DEFAULT NULL,
  `OBJ_ID` int NOT NULL,
  PRIMARY KEY (`AUDIT_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=50 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `city` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `country_id` int DEFAULT NULL COMMENT '城市所在的国家对应的id',
  `state` varchar(256) DEFAULT NULL COMMENT '省或者州的英文名称,若某国家没有这一个行政级别,则为空',
  `name` varchar(256) DEFAULT NULL COMMENT '城市的标准英文名称',
  `lower_name` varchar(256) DEFAULT NULL COMMENT '城市的小写英文名称,用于搜索',
  `cn_state` varchar(256) DEFAULT NULL COMMENT '省或者州的中文名称,若某国家没有这一个行政级别',
  `cn_name` varchar(256) DEFAULT NULL COMMENT '城市的标准中文名称',
  `city_code` varchar(64) DEFAULT NULL COMMENT '城市的代码(一般表示缩写',
  `state_code` varchar(64) DEFAULT NULL COMMENT '省或者州代码(一般表示缩写),若某个国家没有州或省这个行政级别，则为空',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3758 DEFAULT CHARSET=utf8mb3;

CREATE TABLE `country` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT '自增id',
  `continent_id` int DEFAULT NULL COMMENT '对应七大陆continent表的id',
  `name` varchar(256) DEFAULT NULL COMMENT '英文常用标准名称，主要用于显示',
  `lower_name` varchar(256) DEFAULT NULL COMMENT '对应于英文标准名称的小写，主要用于搜索比较',
  `country_code` varchar(64) DEFAULT NULL COMMENT '英文缩写名称，全大写',
  `full_name` varchar(256) DEFAULT NULL COMMENT '英文标准名称全称',
  `cname` varchar(256) DEFAULT NULL COMMENT '中文常用标准名称，通常简称',
  `full_cname` varchar(256) DEFAULT NULL COMMENT '中文全称名称，非缩写',
  `remark` text COMMENT '备注字段，保留',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=213 DEFAULT CHARSET=utf8mb3;

CREATE TABLE `DICT_AUDIT_OPER` (
  `OPER_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `OPER` varchar(200) NOT NULL,
  PRIMARY KEY (`OPER_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10004 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_GROUP` (
  `GROUP_ID` int NOT NULL AUTO_INCREMENT,
  `GROUP_NAME` varchar(200) NOT NULL,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `PARENT_ID` int NOT NULL,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`GROUP_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10009 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_IDENTITY_TYPE` (
  `TYPE_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `TYPE_NAME` varchar(50) CHARACTER SET utf8mb3 COLLATE utf8_general_ci NOT NULL,
  `DELETE_MARK` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT 'NO',
  PRIMARY KEY (`TYPE_ID`) USING HASH
) ENGINE=MEMORY AUTO_INCREMENT=10002 DEFAULT CHARSET=utf8mb3 ROW_FORMAT=DYNAMIC;

CREATE TABLE `DICT_MENU` (
  `MENU_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `MENU` varchar(100) NOT NULL,
  `URL` varchar(200) NOT NULL,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `ICON` varchar(100) DEFAULT NULL,
  `DEFAULT_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`MENU_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10004 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_OBJTYPE` (
  `OBJTYPE_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `OBJTYPE` varchar(200) NOT NULL,
  PRIMARY KEY (`OBJTYPE_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10012 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_PERMISSION` (
  `PERMISSION_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `PERMISSION_NAME` varchar(30) CHARACTER SET utf8mb3 COLLATE utf8_general_ci NOT NULL,
  `DELETE_MARK` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT 'NO',
  `URL` varchar(200) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT NULL,
  `PARENT_ID` int DEFAULT '1',
  `ICON` varchar(100) DEFAULT NULL,
  `PAGEKEY` varchar(500) DEFAULT NULL,
  PRIMARY KEY (`PERMISSION_ID`) USING HASH
) ENGINE=MEMORY AUTO_INCREMENT=100042 DEFAULT CHARSET=utf8mb3 ROW_FORMAT=DYNAMIC;

CREATE TABLE `DICT_ROLE` (
  `ROLE_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `ROLE_NAME` varchar(30) CHARACTER SET utf8mb3 COLLATE utf8_general_ci NOT NULL,
  `DELETE_MARK` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT 'NO',
  PRIMARY KEY (`ROLE_ID`) USING HASH
) ENGINE=MEMORY AUTO_INCREMENT=10032 DEFAULT CHARSET=utf8mb3 ROW_FORMAT=DYNAMIC;

CREATE TABLE `DICT_ROLE_MENU` (
  `ID` int NOT NULL AUTO_INCREMENT,
  `ROLE_ID` int NOT NULL,
  `MENU_ID` int NOT NULL,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10039 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_ROLE_PERMISSION` (
  `ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `PERMISSION_ID` int NOT NULL,
  `ROLE_ID` int NOT NULL,
  `DELETE_MARK` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT 'NO',
  `LOCKED_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`ID`) USING HASH
) ENGINE=MEMORY AUTO_INCREMENT=10237 DEFAULT CHARSET=utf8mb3 ROW_FORMAT=DYNAMIC;

CREATE TABLE `DICT_SCOPE` (
  `SCOPE_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `SCOPE` varchar(100) NOT NULL,
  PRIMARY KEY (`SCOPE_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10002 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_STATUS` (
  `STATUS_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `STATUS` varchar(200) NOT NULL,
  PRIMARY KEY (`STATUS_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_SYS_OPERATION` (
  `OPER_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `OPER` varchar(200) NOT NULL,
  PRIMARY KEY (`OPER_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10004 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `DICT_USER_ROLE` (
  `ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `USER_ID` int NOT NULL,
  `ROLE_ID` int NOT NULL,
  `DELETE_MARK` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_unicode_ci DEFAULT 'NO',
  `LOCKED_MARK` varchar(3) COLLATE utf8_unicode_ci DEFAULT 'NO',
  `GROUP_ID` int DEFAULT '10005',
  PRIMARY KEY (`ID`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=21527 DEFAULT CHARSET=utf8mb3 COLLATE=utf8_unicode_ci ROW_FORMAT=DYNAMIC;

CREATE TABLE `MESSAGE` (
  `MESSAGE_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `CONTENT` varchar(1000) NOT NULL,
  `SCOPE` int DEFAULT NULL,
  `SPECIFIC_USERS` varchar(4000) DEFAULT NULL,
  `TITLE` varchar(100) NOT NULL,
  PRIMARY KEY (`MESSAGE_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `REPORT` (
  `REPORT_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `OBJTYPE_ID` int NOT NULL,
  `DEFENSE` int NOT NULL,
  `REASON` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `PROSECUTION` mediumtext NOT NULL,
  `HANDLE_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`REPORT_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=10030 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `SYSLOG` (
  `LOG_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  `OBJTYPE_ID` int NOT NULL,
  `OBJ_ID` int NOT NULL,
  `OPERATOR` int NOT NULL,
  `OPERATION` int NOT NULL,
  `MESSAGE` varchar(200) NOT NULL,
  PRIMARY KEY (`LOG_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=280 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `USER` (
  `USER_ID` int NOT NULL AUTO_INCREMENT,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `COUNTRY` varchar(50) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT NULL,
  `CITY` varchar(50) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT NULL,
  `NAME` varchar(100) DEFAULT NULL,
  `IDENTITY_NO` varchar(30) DEFAULT NULL,
  `IFVERIFIED` varchar(3) DEFAULT 'NO',
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`USER_ID`) USING HASH
) ENGINE=MEMORY AUTO_INCREMENT=10023 DEFAULT CHARSET=utf8mb3 ROW_FORMAT=DYNAMIC;

CREATE TABLE `USER_AUTH` (
  `AUTH_ID` int NOT NULL AUTO_INCREMENT,
  `USER_ID` int NOT NULL,
  `CREATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `IDENTITY_TYPE` int NOT NULL,
  `IDENTIFIER` varchar(50) CHARACTER SET utf8mb3 COLLATE utf8_general_ci NOT NULL,
  `CREDENTIAL` varchar(100) CHARACTER SET utf8mb3 COLLATE utf8_general_ci NOT NULL,
  `IFVERIFIED` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT 'NO',
  `DELETE_MARK` varchar(3) DEFAULT 'NO',
  PRIMARY KEY (`AUTH_ID`) USING HASH
) ENGINE=MEMORY AUTO_INCREMENT=10021 DEFAULT CHARSET=utf8mb3 ROW_FORMAT=DYNAMIC;

```

### 数据库-UAhouse

```mysql
共6张表
CREATE TABLE `Contact` (
  `contactId` int NOT NULL AUTO_INCREMENT,
  `houseId` int NOT NULL,
  `createTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'NO',
  `content` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `typeId` int NOT NULL,
  PRIMARY KEY (`contactId`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=82 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `contactType` (
  `typeId` int NOT NULL AUTO_INCREMENT,
  `createTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'NO',
  `contactName` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  PRIMARY KEY (`typeId`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `filename` (
  `picId` int NOT NULL AUTO_INCREMENT,
  `createTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(255) NOT NULL DEFAULT 'NO',
  `filePath` varchar(500) NOT NULL,
  `houseId` int NOT NULL,
  PRIMARY KEY (`picId`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `HouseInfo` (
  `houseId` int unsigned NOT NULL AUTO_INCREMENT,
  `userId` int NOT NULL,
  `createTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT 'NO',
  `title` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'WE CAN OFFER HELP',
  `country` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `province` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `city` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `address` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `guests` int DEFAULT '1',
  `pets` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'NO',
  `duration` int DEFAULT '1',
  `description` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `active` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'YES',
  PRIMARY KEY (`houseId`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=61 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `tag` (
  `tagId` int NOT NULL AUTO_INCREMENT,
  `houseId` int NOT NULL,
  `createTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'NO',
  `typeId` int NOT NULL,
  PRIMARY KEY (`tagId`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=143 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `tagType` (
  `typeId` int NOT NULL AUTO_INCREMENT,
  `createTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT 'NO',
  `tagName` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  PRIMARY KEY (`typeId`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

### 数据库 UANews

```mysql
一张表
CREATE TABLE `article` (
  `articleId` int NOT NULL AUTO_INCREMENT COMMENT 'int文章的唯一ID',
  `createTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `deleteMark` varchar(3) CHARACTER SET utf8mb3 COLLATE utf8_general_ci DEFAULT 'NO',
  `author` int NOT NULL,
  `title` varchar(100) NOT NULL COMMENT '标题',
  `content` longtext NOT NULL COMMENT '文章的内容',
  `status` int DEFAULT '1',
  `groupId` int DEFAULT NULL,
  PRIMARY KEY (`articleId`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=42 DEFAULT CHARSET=utf8mb3;
```

## 附录2-nginx.conf

```
# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
 pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

limit_req_zone $uri zone=api_read:20m rate=50r/s;

    limit_conn_zone $binary_remote_addr zone=addr:10m; 
 limit_conn_zone $server_name zone=perserver_conn:100m;


    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80 ;
      
        server_name  localhost;


        location / {
		root  /Uk/build;
		index  index.html;
		try_files $uri /index.html;
		# proxy_pass http://my_upstream;
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }
upstream gateway {
	
		server 127.0.0.1:9001;
		server 127.0.0.1:9002;
		server 127.0.0.2:9011;
	}


    server {
	
        listen       81;
        server_name  localhost;
        root         /usr/share/nginx/html;

limit_req zone=api_read burst=100;
# limit_conn perip_conn 50;
 limit_conn perserver_conn 200;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / {
#limit_req zone=api_read burst=100;
 #limit_conn perip_conn 50;
 #limit_conn perserver_conn 200;

	proxy_pass http://gateway/;
	proxy_connect_timeout 6000;
	proxy_read_timeout 6000;
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }


# Settings for a TLS enabled server.
#
#    server {
#        listen       443 ssl http2 default_server;
#        listen       [::]:443 ssl http2 default_server;
#        server_name  _;
#        root         /usr/share/nginx/html;
#
#        ssl_certificate "/etc/pki/nginx/server.crt";
#        ssl_certificate_key "/etc/pki/nginx/private/server.key";
#        ssl_session_cache shared:SSL:1m;
#        ssl_session_timeout  10m;
#        ssl_ciphers HIGH:!aNULL:!MD5;
#        ssl_prefer_server_ciphers on;
#
#        # Load configuration files for the default server block.
#        include /etc/nginx/default.d/*.conf;
#
#        location / {
#        }
#
#        error_page 404 /404.html;
#            location = /40x.html {
#        }
#
#        error_page 500 502 503 504 /50x.html;
#            location = /50x.html {
#        }
#    }

}


```

## 附录3-nginx配置 

```mysql
/*
Navicat MySQL Data Transfer
Source Server         : 1.15.150.139-MES
Source Server Version : 50736
Source Host           : 1.15.150.139:3306
Source Database       : nacos-mysql
Target Server Type    : MYSQL
Target Server Version : 50736
File Encoding         : 65001
Date: 2022-02-17 14:57:58
*/
 
SET FOREIGN_KEY_CHECKS=0;
 
-- ----------------------------
-- Table structure for config_info
-- ----------------------------
DROP TABLE IF EXISTS `config_info`;
CREATE TABLE `config_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'data_id',
  `group_id` varchar(255) COLLATE utf8_bin DEFAULT NULL,
  `content` longtext COLLATE utf8_bin NOT NULL COMMENT 'content',
  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  `src_user` text COLLATE utf8_bin COMMENT 'source user',
  `src_ip` varchar(20) COLLATE utf8_bin DEFAULT NULL COMMENT 'source ip',
  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL,
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT '租户字段',
  `c_desc` varchar(256) COLLATE utf8_bin DEFAULT NULL,
  `c_use` varchar(64) COLLATE utf8_bin DEFAULT NULL,
  `effect` varchar(64) COLLATE utf8_bin DEFAULT NULL,
  `type` varchar(64) COLLATE utf8_bin DEFAULT NULL,
  `c_schema` text COLLATE utf8_bin,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info';
 
-- ----------------------------
-- Records of config_info
-- ----------------------------
 
-- ----------------------------
-- Table structure for config_info_aggr
-- ----------------------------
DROP TABLE IF EXISTS `config_info_aggr`;
CREATE TABLE `config_info_aggr` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'data_id',
  `group_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'group_id',
  `datum_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'datum_id',
  `content` longtext COLLATE utf8_bin NOT NULL COMMENT '内容',
  `gmt_modified` datetime NOT NULL COMMENT '修改时间',
  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL,
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT '租户字段',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='增加租户字段';
 
-- ----------------------------
-- Records of config_info_aggr
-- ----------------------------
 
-- ----------------------------
-- Table structure for config_info_beta
-- ----------------------------
DROP TABLE IF EXISTS `config_info_beta`;
CREATE TABLE `config_info_beta` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT 'group_id',
  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL COMMENT 'app_name',
  `content` longtext COLLATE utf8_bin NOT NULL COMMENT 'content',
  `beta_ips` varchar(1024) COLLATE utf8_bin DEFAULT NULL COMMENT 'betaIps',
  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  `src_user` text COLLATE utf8_bin COMMENT 'source user',
  `src_ip` varchar(20) COLLATE utf8_bin DEFAULT NULL COMMENT 'source ip',
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT '租户字段',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta';
 
-- ----------------------------
-- Records of config_info_beta
-- ----------------------------
 
-- ----------------------------
-- Table structure for config_info_tag
-- ----------------------------
DROP TABLE IF EXISTS `config_info_tag`;
CREATE TABLE `config_info_tag` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT 'group_id',
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT 'tenant_id',
  `tag_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT 'tag_id',
  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL COMMENT 'app_name',
  `content` longtext COLLATE utf8_bin NOT NULL COMMENT 'content',
  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  `src_user` text COLLATE utf8_bin COMMENT 'source user',
  `src_ip` varchar(20) COLLATE utf8_bin DEFAULT NULL COMMENT 'source ip',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag';
 
-- ----------------------------
-- Records of config_info_tag
-- ----------------------------
 
-- ----------------------------
-- Table structure for config_tags_relation
-- ----------------------------
DROP TABLE IF EXISTS `config_tags_relation`;
CREATE TABLE `config_tags_relation` (
  `id` bigint(20) NOT NULL COMMENT 'id',
  `tag_name` varchar(128) COLLATE utf8_bin NOT NULL COMMENT 'tag_name',
  `tag_type` varchar(64) COLLATE utf8_bin DEFAULT NULL COMMENT 'tag_type',
  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT 'group_id',
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT 'tenant_id',
  `nid` bigint(20) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`nid`),
  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation';
 
-- ----------------------------
-- Records of config_tags_relation
-- ----------------------------
 
-- ----------------------------
-- Table structure for group_capacity
-- ----------------------------
DROP TABLE IF EXISTS `group_capacity`;
CREATE TABLE `group_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `group_id` varchar(128) COLLATE utf8_bin NOT NULL DEFAULT '' COMMENT 'Group ID，空字符表示整个集群',
  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',
  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',
  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数，，0表示使用默认值',
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',
  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_group_id` (`group_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='集群、各Group容量信息表';
 
-- ----------------------------
-- Records of group_capacity
-- ----------------------------
 
-- ----------------------------
-- Table structure for his_config_info
-- ----------------------------
DROP TABLE IF EXISTS `his_config_info`;
CREATE TABLE `his_config_info` (
  `id` bigint(64) unsigned NOT NULL,
  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `data_id` varchar(255) COLLATE utf8_bin NOT NULL,
  `group_id` varchar(128) COLLATE utf8_bin NOT NULL,
  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL COMMENT 'app_name',
  `content` longtext COLLATE utf8_bin NOT NULL,
  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL,
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00',
  `src_user` text COLLATE utf8_bin,
  `src_ip` varchar(20) COLLATE utf8_bin DEFAULT NULL,
  `op_type` char(10) COLLATE utf8_bin DEFAULT NULL,
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT '租户字段',
  PRIMARY KEY (`nid`),
  KEY `idx_gmt_create` (`gmt_create`),
  KEY `idx_gmt_modified` (`gmt_modified`),
  KEY `idx_did` (`data_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='多租户改造';
 
-- ----------------------------
-- Records of his_config_info
-- ----------------------------
 
-- ----------------------------
-- Table structure for roles
-- ----------------------------
DROP TABLE IF EXISTS `roles`;
CREATE TABLE `roles` (
  `username` varchar(50) NOT NULL,
  `role` varchar(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
 
-- ----------------------------
-- Records of roles
-- ----------------------------
INSERT INTO `roles` VALUES ('nacos', 'ROLE_ADMIN');
 
-- ----------------------------
-- Table structure for tenant_capacity
-- ----------------------------
DROP TABLE IF EXISTS `tenant_capacity`;
CREATE TABLE `tenant_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `tenant_id` varchar(128) COLLATE utf8_bin NOT NULL DEFAULT '' COMMENT 'Tenant ID',
  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',
  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',
  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数',
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',
  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',
  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='租户容量信息表';
 
-- ----------------------------
-- Records of tenant_capacity
-- ----------------------------
 
-- ----------------------------
-- Table structure for tenant_info
-- ----------------------------
DROP TABLE IF EXISTS `tenant_info`;
CREATE TABLE `tenant_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `kp` varchar(128) COLLATE utf8_bin NOT NULL COMMENT 'kp',
  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT 'tenant_id',
  `tenant_name` varchar(128) COLLATE utf8_bin DEFAULT '' COMMENT 'tenant_name',
  `tenant_desc` varchar(256) COLLATE utf8_bin DEFAULT NULL COMMENT 'tenant_desc',
  `create_source` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT 'create_source',
  `gmt_create` bigint(20) NOT NULL COMMENT '创建时间',
  `gmt_modified` bigint(20) NOT NULL COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info';
 
-- ----------------------------
-- Records of tenant_info
-- ----------------------------
 
-- ----------------------------
-- Table structure for users
-- ----------------------------
DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
  `username` varchar(50) NOT NULL,
  `password` varchar(500) NOT NULL,
  `enabled` tinyint(1) NOT NULL,
  PRIMARY KEY (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
 
-- ----------------------------
-- Records of users
-- ----------------------------
INSERT INTO `users` VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', '1');
```

